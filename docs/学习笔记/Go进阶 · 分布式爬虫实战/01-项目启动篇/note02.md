# 02|内有乾坤：Go语言六大基础知识体系

## 语法特性

### defer

defer 是Go的关键字，也是Go语言的重要特性之一，defer在资源释放、panic捕获等场景使用广泛。
```go
defer func(...) {
	// 实际处理
}()
```
defer的重要特性，包括：

- 延迟执行
- 参数预计算
- LIFO执行顺序

同时，Go中错误恢复函数`recover`函数，也需要和defer结合起来才有意义。

### 接口

接口是Go语言中实现模块解耦、代码复用和控制系统复杂度的重要手段。Go中的接口类型有两种类型，分别是“带方法的接口”和“空接口”。带方法的接口
内部有一系列方法签名，而空接口内部不包含任何东西，可以存储任何类型。

接口部分需要掌握的是：

1. 接口的声明与定义
2. 隐式的让一个类型实现接口
3. 接口的动态调用方式
4. 接口的嵌套
5. 接口类型断言
6. 根据空接口中动态类型的差异选择不同的处理方式
7. 接口的比较性

### 并发编程

重要概念：

- 进程、线程和协程。进程是操作系统资源分配的基本单位，线程是操作系统资源调度的基本单位。而协程位于用户态，是在线程基础上构建的轻量级调度单位
- 并发与并行。并行是指同时做很多事情，并发是指同时管理很多事情
- 主协程与子协程。main函数是特殊的主协程，它退出后整个程序都会退出。而其他协程都是子协程，子协程退出后，程序正常运行。

Go语言实现了CSP并发编程模型，把Channel当作Go语言中的一等公民，Channel的基本使用方式包括：

- 通道声明与初始化
- 通道写入数据
- 通道读取数据
- 通道关闭
- 通道作为参数
- 通道作为返回值
- 单方向通道，用于只读和只写场景
- select监听多个通道实现多路复用

Go除了使用通道完成协程间的通信以外，还有其他手段：

- 用context来处理协程的优雅退出和级联退出
- 传统的同步原语：原子锁。Go提供了atomic包用于处理原子操作
- 传统的同步原语：互斥锁
- 传统的同步原语：读写锁

## 项目组织

### 依赖管理

Go Module成为依赖管理的事实标准。

### 面向组合

构建大规模程序需要我们完成必要的抽象，这样才能屏蔽一些细节，然后从更高的层面去构建大规模程序。

### 工具与库

#### 工具：代码分析与代码规范

Go自带了很多工具，可以规范代码、提高可读性、促进团队协作、检查代码错误等。

工具可以分为静态与动态两种类型。其中，静态工具对代码进行静态扫描，检查代码的结构、风格以及语法错误，这种工具也被称为Linter。

- go fmt：静态工具，格式化代码、规范代码的风格，也可以使用`gofmt`命令对单独的文化进行格式化
- go doc：生成和阅读代码的文档说明。
- go vet：代码静态诊断器，对代码风格进行检查，并且报告可能有问题的地方。
- golangci-lint：社区的Linter
- go race：排查数据争用问题

#### 工具：代码测试

测试函数位于单独的以`_test.go`结尾的文件中，测试函数名以`Test`开头。
单元测试是指测试代码中的某一个函数或功能。

- go test：运行测试用例
- go test -cover：统计测试代码的覆盖率
- go tool cover：收集覆盖率并可视化展示
- go test -bench：Benchmark测试，测试的函数的前缀名需要为Benchmark

#### 工具：代码调试

- dlv：Go官方提供的一个简单、功能齐全的调试工具。
- gdb：通用的程序调试器
- pprof：指标与特征进行分析的工具
- trace：获取程序在指定时间内所发生的事件的完整信息
- gops：谷歌推出的调试工具，gops可以查看系统中的所有的Go进程，并可以查看特定进程的堆栈、内存信息等

#### 标准库

Go也是自带电池的语言，提供了很多功能强大的标准库。标准库是官方维护的，用于增强和扩展语言的核心库。

#### 第三方库

第三方库是很多的，利用第三方库，可以减少重复造轮子。